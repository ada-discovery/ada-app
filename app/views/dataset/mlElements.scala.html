@import views.html.elements.labelValue
@import views.html.table.{dynamicStringTable, dynamicTableJsImport}
@import views.html.dataset.dynamicFieldTable

@(
    allFieldsCall: Call,
    includeOutputField: Boolean = true,
    includeTrainingSettingFields: Boolean = true
)

@dynamicTableJsImport()

@addAllFieldButton = {
    <a id="addAllFieldsButton" class="btn btn-info btn-sm" href="#" onclick="addAllFields();" data-toggle="tooltip" title="Add All Fields">
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> All
    </a>
}

<div class="row">
    <div class="col-md-12">
        <form>
            <fieldset>
                @labelValue("mlModel", "ML Model") {
                    <input id="mlModelTypeahead" class="typeahead typeahead-large" type="text" placeholder="ML Model" value="">
                    <input id="mlModelId" name="mlModelId" type="hidden" value="">
                }
                @if(includeOutputField) {
                    @labelValue("outputField", "Output Field") {
                        <input id="outputFieldTypeahead" class="typeahead typeahead-large" type="text" placeholder="Field Name" value="">
                        <input id="outputFieldName" name="outputFieldName" type="hidden" value="">
                    }
                }
                @labelValue("inputFieldNames", "Input Field Names") {
                    @dynamicFieldTable("inputFieldName", Nil, false, 5, Some(addAllFieldButton))
                }
                @labelValue("filterId", "Filter") {
                    <input id="filterNameTypeahead" class="typeahead typeahead-large" type="text" placeholder="Filter" value="">
                    <input id="filterId" name="filterId" type="hidden" value="">
                }
                <hr/>
                @labelValue("pcaDims", "PCA Dims") {
                    <input id="pcaDims" type="text" class="input-lg" placeholder="PCA Dims" value="">
                }
                @if(includeTrainingSettingFields) {
                    @labelValue("trainingTestingSplit", "Training Testing Split") {
                        <input id="trainingTestingSplit" type="text" class="input-lg" placeholder="Training Testing Split" value="">
                    }
                    @labelValue("repetitions", "Repetitions") {
                        <input id="repetitions" type="text" class="input-lg" placeholder="Repetitions" value="">
                    }
                    @labelValue("crossValidationFolds", "Cross Validation Folds") {
                        <input id="crossValidationFolds" type="text" class="input-lg" placeholder="Cross Validation Folds" value="">
                    }
                }
            </fieldset>

            <div class="actions pull-right">
                <button id="launchButton" type="button" class="btn btn-primary">Submit</button>
            </div>
        </form>
    </div>
</div>

<hr/>

<div class="row">
    <div class="col-md-6">
        <div id="outputDiv">
        </div>
    </div>
</div>

<script>
    function addAllFields() {
        $.ajax({
            url: '@Html(allFieldsCall.url)',
            success: function (data) {
                $.each(data, function(index, field) {
                    console.log(field)

                    var values = {};
                    values["fieldName"] = field.name;
                    values["fieldTypeahead"] = field.label ? field.label : field.name;

                    $('#inputFieldNameDiv').dynamicTable('addTableRow', values)
                });
            }
        });
    }
</script>