@import models.FieldChartSpec
@import views.html.widget.widgetPanel
@import util.widgetElementId

@(
    filterElementName: String,
    fieldChartSpecs: Traversable[FieldChartSpec],
    gridElementWidth: Int = 3
)

@widgetPanel(fieldChartSpecs.map(_.chartSpec), gridElementWidth)

@jsListenToPointClick(chartElementName : String, fieldName : String) = {
    $('#@chartElementName').on('pointClick', function(event, data) {
//        alert('Point clicked: name ' + data.name + ', y: ' + data.y + ', k: ' + data.key);
        var condition = { fieldName : "@fieldName", conditionType : "=", value : data.key};
        $('#@filterElementName').multiFilter('addAndSubmitCondition', condition);
    });
}

<script type="text/javascript">
    $(function () {
        @fieldChartSpecs.map { case FieldChartSpec(fieldName, chartSpec) =>
            @{chartSpec match {
                case x: CategoricalCountWidget => jsListenToPointClick(widgetElementId(x), fieldName)
                case _ => ""
            }
        }
    }});
</script>