@import controllers.dataset.DataSetRouter
@import models.DataSpaceMetaInfo
@import util.{getParamValue, matchesPath}
@import controllers.dataset.routes.{DataSpaceMetaInfoController => dataSpaceMetaInfoRoutes}
@import reactivemongo.bson.BSONObjectID

@(dataSpaceMetaInfos: Traversable[DataSpaceMetaInfo])(implicit request: Request[_])

@listItem(call: Call, dataSetId: String, text: String) = {
    @defining(getParamValue(request.uri, "dataSet")) { reqDataSetId =>
        <li @if(reqDataSetId.isDefined && reqDataSetId.get.equals(dataSetId)) {class="active dataset"} else {class="dataset"}>
            <a href="@call">
                <ul class="list-inline">
                    <li>
                        <span class="glyphicon glyphicon-chevron-right"></span>
                    </li>
                    <li>
                        <h5>@text</h5>
                    </li>
                </ul>
            </a>
        </li>
    }
}

@spaceItem(id: BSONObjectID, text: String) = {
    @defining(dataSpaceMetaInfoRoutes.get(id)) { call =>
        <li @if(matchesPath(call.url, request.uri, Some(3))) { class="dataspace active"} else { class="dataspace"}>
            <button type="button" class="btn btn-sm btn-default btn-dataspace-expand" data-toggle="collapse" data-target="#dataSets-@id.stringify">
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
            </button>
            <a href="@call" class="float-left">
                <h4>@text</h4>
            </a>
        </li>
    }
}

<!--
    <h3 class="text-muted" align="center">Studies</h3>
    <hr/>
-->

<ul class="sidebar-nav nav nav-pills nav-stacked">
    @dataSpaceMetaInfos.toSeq.sortBy(_.sortOrder).map { spaceMetaInfo =>
        @spaceItem(spaceMetaInfo._id.get, spaceMetaInfo.name)
        <div id="dataSets-@{spaceMetaInfo._id.get.stringify}" class="collapse clear-left datasets-div sidebar-nav nav nav-pills nav-stacked">
            @spaceMetaInfo.dataSetMetaInfos.filter(!_.hide).sortBy(_.sortOrder).map { setMetaInfo =>
                @listItem(new DataSetRouter(setMetaInfo.id).plainOverviewList, setMetaInfo.id, setMetaInfo.name)
            }
        </div>
    }
</ul>

<script type="text/javascript">
    $(".datasets-div").each(function() {
        if($(this).find("li.dataset.active").size() > 0) {
            $(this).addClass("in")
            updatePlusMinusIcon($(this).prev());
        }
    });
    $(".dataspace.active").each(function() {
        $(this).next().addClass("in");
        updatePlusMinusIcon($(this));
    });
    $('.btn-dataspace-expand').on('click', function() {
        updatePlusMinusIcon($(this));
    });

    function updatePlusMinusIcon(element) {
        var iconPlus = element.find("span.glyphicon-plus:first");
        var iconMinus = element.find("span.glyphicon-minus:first");
        if (iconPlus.length) {
            iconPlus.removeClass("glyphicon-plus");
            iconPlus.addClass("glyphicon-minus");
        } else {
            iconMinus.removeClass("glyphicon-minus");
            iconMinus.addClass("glyphicon-plus");
        }
    }
</script>