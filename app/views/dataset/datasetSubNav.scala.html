@import util.{matchesPath, getParamValue}
@import controllers.dataset.{DataSetRouter, DictionaryRouter, CategoryRouter, FilterRouter, DataViewRouter}
@import controllers.dataset.routes.{DataSetSettingController => dataSetSettingRoutes}

@()(implicit request: Request[_])

@listItem(call: Call, text: String, matchPrefixDepth : Option[Int] = None) = {
    <li @if(matchesPath(call.url, request.uri, matchPrefixDepth)) {class="active"}>
        <a href="@call">@text</a>
    </li>
}

@defining(getParamValue(request.uri, "dataSet").get) { dataSetId =>
    @defining((
        new DataSetRouter(dataSetId),
        new DictionaryRouter(dataSetId),
        new CategoryRouter(dataSetId),
        new FilterRouter(dataSetId),
        new DataViewRouter(dataSetId)
    )) { case (dataSetRouter, dictionaryRouter, categoryRouter, filterRouter, dataViewRouter) =>
        <ul class="nav nav-tabs">
            @listItem(dataSetRouter.plainOverviewList, "Overview", Some(2))
            @listItem(dictionaryRouter.plainList, "Dictionary", Some(2))
            @listItem(categoryRouter.plainList, "Category Tree", Some(2))
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">Analytics<span class="caret"></span></a>
                <ul class="dropdown-menu">
                    @listItem(dataSetRouter.plainGetDistribution, "Distribution", Some(2))
                    @listItem(dataSetRouter.plainGetScatterStats, "Scatter Analysis", Some(2))
                    @listItem(dataSetRouter.getDateCount(None, None, Left(Nil)), "Count by Date", Some(2))
                </ul>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">Setting<span class="caret"></span></a>
                <ul class="dropdown-menu">
                    @listItem(dataSetSettingRoutes.editForDataSet(dataSetId), "General", Some(2))
                    @listItem(filterRouter.plainList, "Filters", Some(2))
                    @listItem(dataViewRouter.plainList, "Views", Some(2))
                </ul>
            </li>
        </ul>
    }
}

<script type="text/javascript">
    $("li.dropdown").each(function() {
        if($(this).find("li.active").size() > 0)
            $(this).addClass("active")
    });
</script>