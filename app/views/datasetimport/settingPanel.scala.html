@import views.html.elements._
@import util.toHumanReadableCamel

@(form: Form[_])(implicit msg: Messages)

<div class="panel panel-default">
    <div class="panel-heading">Setting</div>
    <div class="panel-body">
        @yesNoRadio("dataSetImport", "includeSetting", form, Some("Do you want to specify a setting now?"))
        <div id="settingDiv" style="display:none">
            <input type="hidden" id="setting_dataSetId" name="setting.dataSetId" value="">
            <hr/>
            @inputText("dataSetImport", "setting.keyFieldName", form)
            @inputText("dataSetImport", "setting.exportOrderByFieldName", form)
            @inputText("dataSetImport", "setting.defaultDistributionFieldName", form)
            @inputText("dataSetImport", "setting.defaultScatterXFieldName", form)
            @inputText("dataSetImport", "setting.defaultScatterYFieldName", form)
            @inputText("dataSetImport", "setting.defaultCumulativeCountFieldName", form)
            @select("dataSetImport", "setting.filterShowFieldStyle", form,
                FilterShowFieldStyle.values.toSeq.sortBy(_.id).map(value => (value.toString, toHumanReadableCamel(value.toString))), true
            )
            @checkbox("dataSetImport", "setting.filterShowNonNullCount", form)
            @inputText("dataSetImport", "setting.tranSMARTVisitFieldName", form)
            @inputText("dataSetImport", "setting.tranSMARTReplacements", form)
            @select("dataSetImport", "setting.storageType", form,
                StorageType.values.toSeq.sortBy(_.id).map(value => (value.toString, value.toString)), true
            )
            @checkbox("dataSetImport", "setting.mongoAutoCreateIndexForProjection", form)
            @checkbox("dataSetImport", "setting.cacheDataSet", form)
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function() {
        var settingValueFound = false;
        $.each( $("input[name^='setting.']"), function () {
            if ($(this).val()) {
                settingValueFound = true;
                return false;
            }
        });

        if (settingValueFound) {
            $('input[name="includeSetting"][value="true"]').attr('checked', 'checked')
            $('input[name="includeSetting"][value="false"]').attr('checked', '')
            $('#settingDiv').show()
        }
    });

    $('input[name="includeSetting"]').change(function() {
        var includeSetting = $('input[name="includeSetting"]:checked').val() == "true"
        if (includeSetting)
            $('#settingDiv').show()
        else
            $('#settingDiv').hide()
    })

    function handleSettingSubmission() {
        var includeSetting = $('input[name="includeSetting"]:checked').val() == "true"
        if (includeSetting)
            $('#setting_dataSetId').val($('#dataSetId').val())
        else {
            // if setting should not be included remove all setting fields from the form by erasing their names before submit
            $.each( $("input[name^='setting.']"), function () {
                $(this).attr("name", '');
            });
        }
    }
</script>