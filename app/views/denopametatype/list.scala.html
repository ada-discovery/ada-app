@import helper.{select}
@import reactivemongo.bson.BSONObjectID
@import util.FilterSpec

@(domainName : String, currentPage: Page[MetaTypeStats], findCall : (Int, String, FilterSpec) => Call, plainFindCall : Call, getCall : BSONObjectID => Call)(implicit flash: play.api.mvc.Flash, msg: play.api.i18n.Messages, request: RequestHeader)

@**********************************
* Helper generating table headers *
***********************************@
@header(fieldName: String, title: String) = {
    <th class="col header @if(currentPage.orderBy == fieldName){glyphicon glyphicon-chevron-down} @if(currentPage.orderBy == "-" + fieldName){glyphicon glyphicon-chevron-up}">
        <a href="@displayCall(0, Some(fieldName))">@title</a>
    </th>
}

@actions = {
    <div class="row">
        <div class="col-md-8">
            @filter(currentPage.filter, plainFindCall)
        </div>
    </div>
}

@formatDouble(d : Double) = @{
    if (d == 0d)
        "0"
    else
        "%,.3f".format(d)
}

@table = {
    <table class="table table-striped">
        <thead>
            <tr>
                @header("attributeName", "Name")
                @header("intRatio", "Int Ratio")
                @header("longRatio", "Long Ratio")
                @header("floatRatio", "Float Ratio")
                @header("doubleRatio", "Double Ratio")
                @header("nullRatio", "Null Ratio")
            </tr>
        </thead>
        <tbody>

        @currentPage.items.map { item =>
            <tr class='clickable-row' data-href='@getCall(item._id.get)'>
                <td>@item.attributeName</td>
                <td>@formatDouble(item.intRatio)</td>
                <td>@formatDouble(item.longRatio)</td>
                <td>@formatDouble(item.floatRatio)</td>
                <td>@formatDouble(item.doubleRatio)</td>
                <td>@formatDouble(item.nullRatio)</td>
            </tr>
        }

        </tbody>
    </table>
}

@displayCall(newPage : Int, newOrderBy : Option[String]) = @{
    findCall(newPage, newOrderBy.map { orderBy =>
        if(orderBy == currentPage.orderBy) "-" + currentPage.orderBy else orderBy
    }.getOrElse(currentPage.orderBy), currentPage.filter)
}

@views.html.list(
    domainName,
    actions,
    table,
    displayCall,
    currentPage
)