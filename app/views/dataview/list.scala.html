@import views.html.layout
@import views.html.dataset.{filterChartPanel, datasetSubNav, datasetMenu}
@import views.html.table.paginatedTable
@import views.html.dataview.dataViewSelectionModal
@import models.DataView
@import util.typeColumns
@import controllers.dataset.{DataViewRouter, DataViewJsRouter}
@import models.DataSpaceMetaInfo
@import models.Field

@import reactivemongo.bson.BSONObjectID
@(
    domainName : String,
    page: Page[DataView],
    router: DataViewRouter,
    jsRouter: DataViewJsRouter,
    dataSpaceMetaInfos: Traversable[DataSpaceMetaInfo]
)(
    implicit flash: play.api.mvc.Flash, msg: play.api.i18n.Messages, request: Request[_]
)

@actions = {
    <div class="row">
        <div class="col-md-10">
            @filter(
                page.filter,
                router.plainList,
                Left(Seq(Field("name", None)))
            )
        </div>
        <div class="pull-right">
            <ul class="list-inline">
                <li>
                    <a class="btn btn-success btn-sm pull-right" href="@router.create" data-toggle="tooltip" title="Add New View">
                        <span class="glyphicon glyphicon-plus"></span>
                    </a>
                </li>
                <li>
                    <a class="btn btn-success btn-sm pull-right" href="#" data-toggle="modal" data-target="#dataViewSelectionModal" title="Copy View">
                        <span class="glyphicon glyphicon-duplicate"></span>
                    </a>
                </li>
            </ul>
            @dataViewSelectionModal("dataViewSelectionModal", router, Some(router.copy(BSONObjectID.generate)))
        </div>
    </div>
}

@table = {
    @paginatedTable(
        page,
        router.list(_, _, page.filterConditions),
        typeColumns[DataView](
            (Some("name"), "Name", _.name),
            (Some("default"), "Default?", _.default.toString),
            (Some("timeCreated"), "Time Created", _.timeCreated.toString),
            (Some("createdById"), "Created By", _.createdBy.map(_.ldapDn).getOrElse("") )
        ),
        Some({ item : Any => router.get(item.asInstanceOf[DataView]._id.get)})
    )
}

@layout.list(
    domainName,
    page.total,
    Some(actions),
    table,
    None,
    Some(datasetMenu(dataSpaceMetaInfos)),
    Some(datasetSubNav())
)