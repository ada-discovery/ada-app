@import views.html.layout
@import views.html.elements.{labelValue, value}
@import views.html.dataset.datasetMenu
@import views.html.table.displayTable
@import controllers.dataset.DataSetRouter
@import util.typeColumns
@import controllers.dataset.routes.{DataSpaceMetaInfoController => dataSpaceMetaInfoRoutes}
@import models.DataSpaceMetaInfo
@import models.DataSetMetaInfo

@(
    dataSpaceMetaInfo: DataSpaceMetaInfo,
    dataSetIdSizeMap: Map[String, Int],
    dataSpaceMetaInfos: Traversable[DataSpaceMetaInfo]
)(
    implicit flash: play.api.mvc.Flash, msg: play.api.i18n.Messages, request: Request[_]
)

@hideCheckbox(dataSetInfo: DataSetMetaInfo) = {
    <input type="checkbox" class="no-rowClicked" @if(dataSetInfo.hide) { checked="checked" } disabled="disabled">
}

@dataSetTable = {
    @displayTable(
        dataSpaceMetaInfo.dataSetMetaInfos.sortBy(_.sortOrder),
        typeColumns[DataSetMetaInfo](
            (None, "Name", _.name),
            (None, "Time Created", _.timeCreated.format("yyyy-MM-dd HH:mm:ss")),
            (None, "# Items", {info: DataSetMetaInfo => dataSetIdSizeMap.get(info.id).get.toString}),
            (None, "Hide?", hideCheckbox)
        ),
        None,
        Some({ item : Any => new DataSetRouter(item.asInstanceOf[DataSetMetaInfo].id).plainOverviewList})
    )
}

@dataSpaceTable = {
    @displayTable(
        dataSpaceMetaInfo.children.sortBy(_.sortOrder),
        typeColumns[DataSpaceMetaInfo](
            (None, "Name", _.name),
            (None, "Time Created", _.timeCreated.format("yyyy-MM-dd HH:mm:ss")),
            (None, "# Items", {info: DataSpaceMetaInfo =>
                info.dataSetMetaInfos.map( setInfo => dataSetIdSizeMap.get(setInfo.id).get).sum.toString
            }),
            (None, "# Data Sets", {info: DataSpaceMetaInfo => info.dataSetMetaInfos.size.toString})
        ),
        None,
        Some({ item : Any => dataSpaceMetaInfoRoutes.get(item.asInstanceOf[DataSpaceMetaInfo]._id.get) })
    )
}

@elements = {
    @value("dataSpaceMetaInfo", "Name", dataSpaceMetaInfo.name)
    @value("dataSpaceMetaInfo", "Time Created", dataSpaceMetaInfo.timeCreated.toString)
    @labelValue("dataSetMetaInfos", "Data Sets"){@dataSetTable}
    @if(dataSpaceMetaInfo.children.nonEmpty) {
        @labelValue("dataSpaceMetaInfos", "(Sub) Data Spaces") {@dataSpaceTable}
    }
}

@layout.show(
    "Study",
    elements,
    None,
    Some(dataSpaceMetaInfoRoutes.edit(dataSpaceMetaInfo._id.get)),
    None,
    Some(datasetMenu(dataSpaceMetaInfos)),
    None
)