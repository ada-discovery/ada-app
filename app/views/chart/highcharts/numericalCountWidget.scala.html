@import models.ChartType
@import models.NumericalCountWidget

@(
    elementId : String,
    chartSpec: NumericalCountWidget[_]
)

@numericValue(x: Any) = @{
    x match {
        case x: java.util.Date => x.getTime.toString
        case _ => x.toString
    }
}

<script type="text/javascript">
    $(function () {
        var isDate = @{chartSpec.data.headOption.map(_._2.headOption.map(_._1.isInstanceOf[java.util.Date])).flatten.getOrElse(false)};
        var isDouble = @{chartSpec.data.headOption.map(_._2.headOption.map(_._1.isInstanceOf[Double])).flatten.getOrElse(false)};
        var dataType = (isDate) ? 'datetime' : null;

        var datas = [@chartSpec.data.map { singleSeries => {name: '@singleSeries._1', data: [@singleSeries._2.map { case (x, y) => [@{numericValue(x)}, @y], }]}, }];

        var seriesSize = datas.length
        var height = @chartSpec.displayOptions.height.getOrElse(400)

        var pointFormat = (isDate) ?
            '<span style="color:{point.color}">{point.x:%Y-%m-%d} (Count)</span>: <b>{point.y:.2f}</b><br/>'
            :
            (isDouble) ?
                '<span style="color:{point.color}">{point.x:.2f} (Count)</span>: <b>{point.y:.2f}</b><br/>'
                :
                '<span style="color:{point.color}">{point.x} (Count)</span>: <b>{point.y:.2f}</b><br/>'

        $('#@elementId').on('chartTypeChanged', function(event, chartType) {
            changeNumericalCountChartType(chartType, datas, seriesSize, '@chartSpec.title', '@{elementId}', height, pointFormat, dataType)
        });

        changeNumericalCountChartType('@chartSpec.displayOptions.chartType', datas, seriesSize, '@chartSpec.title', '@chartSpec.fieldLabel', '@{elementId}', height, pointFormat, dataType)
    });
</script>