@import org.ada.web.util.typeColumns
@import views.html.datasetimport.schedulePanel
@import views.html.datasettrans.{resultDataSetInfoPanel, streamSpecPanel}
@import views.html.table.{displayTable, dynamicTable}
@import views.html.table.dynamicTableJsImport
@import views.html.elements.labelValue
@import views.html.elements._
@import play.api.i18n.Messages
@import org.incal.play.controllers.WebContext
@import org.incal.play.controllers.WebContext._

@(
    collectionFieldName: String,
    tableLabel: String,
    field1Label: String,
    field2Label: String,
    data: Seq[(String, String)] = Nil,
    customRowToModelJs: Option[Html] = None
)(implicit webContext: WebContext)

@dynamicTableJsImport()

@field1Element(item: (String, String)) = {
    <input type="text" id="field1" value="@item._1">
}

@field2Element(item: (String, String)) = {
    <input type="text" id="field2" value="@item._2">
}

@table = {
    @displayTable(
        data,
        typeColumns[(String, String)](
            (None, field1Label, field1Element),
            (None, field2Label, field2Element)
        ),
        tableSelection = true
    )
}

@rowToModelJsFun = {
    function(row) {
        var model = rowToModel(row);
        return JSON.stringify(model);
    }
}

@modalItemToRowJsFun = {
    function(values) {
        var fieldValue1 = values["field1"].trim()
        var fieldValue2 = values["field2"].trim()

        var checkboxColumn = "<td><input type='checkbox' class='table-selection'></input></td>";
        var field1Column = "<td><input type='text' id='field1' value='" + fieldValue1 + "'/></td>";
        var field2Column = "<td><input type='text' id='field2' value='" + fieldValue2 + "'/></td>";

        // create row
        var row = $("<tr></tr>")
        row.append(checkboxColumn)
        row.append(field1Column)
        row.append(field2Column)

        return row;
    }
}

@labelValueAux(key: String, label: Any)(valueElement : Any) = {
    @labelValue(key, label, false, None, 4)(valueElement)
}

@modalInner = {
    <div class="row">
        @labelValueAux("field1", field1Label) {
            <input type="text" id="field1">
        }

        @labelValueAux("field2", field2Label) {
            <input type="text" id="field2">
        }
    </div>
}

@labelValue(collectionFieldName + "s", tableLabel){
    @dynamicTable(collectionFieldName, table, true, rowToModelJsFun, modalItemToRowJsFun, modalInner, None, 12)
}

@customRowToModelJs.getOrElse {
    <script type="text/javascript">
        function rowToModel(row) {
            function value(x) { return getRowValue(row, x) }

            return [value("field1"), value("field2")]
        }
    </script>
}