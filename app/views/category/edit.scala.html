@import views.html.layout
@import views.html.table.{dynamicStringTable, dynamicTableJsImport}
@import views.html.dataset.{datasetSubNav, datasetMenu}
@import views.html.elements._
@import controllers.dataset.CategoryRouter
@import reactivemongo.bson.BSONObjectID
@import play.api.mvc.Flash
@import play.api.i18n.Messages
@import models.DataSpaceMetaInfo
@import models.Category

@import controllers.dataset.DataSetRouter
@(
    domainName : String,
    id : BSONObjectID,
    form: Form[Category],
    categories: Traversable[Category],
    fields: Traversable[models.Field],
    router: CategoryRouter,
    dataSetRouter: DataSetRouter,
    getField: String => Call,
    showFieldStyle: Option[FilterShowFieldStyle.Value],
    dataSpaceMetaInfos: Traversable[DataSpaceMetaInfo]
)(
    implicit flash: Flash, msg: Messages, request: Request[_]
)

@addModalInner = {
    <input type="text" id="newItemTypeahead" class="typeahead">
    <input type="hidden" id="newItem">
}

@elements = {
    @inputText(domainName, "name", form)
    @select(domainName, "parentId", form, categories.map(cat => (cat._id.get.stringify, cat.name)).toSeq, true)

    @dynamicTableJsImport()
    @typeaheadJsImport()

    @labelValue("fields", attributeLabel("category", "fields")){
        @dynamicStringTable("field", fields.map(_.name), true, Some(addModalInner))
    }

    <script type="text/javascript">
        $(function () {
            populateFieldTypeahedFromUrl(
                $('#newItemTypeahead'),
                $('#newItem'),
                '@Html(dataSetRouter.allFields.url)',
                @showFieldStyle.getOrElse(FilterShowFieldStyle.NamesAndLabels).id
            );
        })
    </script>
}

@layout.edit(
    domainName,
	form.errors,
    elements,
    router.update(id),
    router.plainList,
    Some(router.delete(id)),
    Some(datasetMenu(dataSpaceMetaInfos)),
    Some(datasetSubNav())
)