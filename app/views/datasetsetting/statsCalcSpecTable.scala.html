@import views.html.table.{displayTable, dynamicTable}
@import util.typeColumns
@import models.ChartType
@import models.FieldChartType
@import models.StatsCalcSpec

@(items: Traversable[StatsCalcSpec])

@editableChartType(chartType: Option[ChartType.Value]) = {
    <select id="chartType" name="chartType">
        <option value="" @if(chartType.isEmpty) {selected="selected"}></option>
        @ChartType.values.map { _chartType =>
            <option value="@{_chartType}" @if(chartType.isDefined && chartType.get == _chartType) {selected="selected"}>@{_chartType}</option>
        }
    </select>
}

@table = {
    @displayTable(
        items.filter(_.isInstanceOf[DistributionCalcSpec]),
        typeColumns[StatsCalcSpec](
            (None, "", _ => {<input type="checkbox"/>}),
            (Some("fieldNames"), "Field", _.fieldNames.mkString(", ")),
            (None, "Chart Type", {x => editableChartType(x.asInstanceOf[DistributionCalcSpec].chartType)})
        )
    )
}

@rowToModelJsFun = {
    function(row) {
        var fieldNames = row.find('#fieldNames').text().trim().split(",");
        var jsonFieldNames = JSON.stringify(fieldNames)
        var chartType = row.find('#chartType').val().trim();
        if (chartType)
            return '{"concreteClass": "models.DistributionCalcSpec", "fieldName": "' +  fieldNames[0] + '", "chartType": "' + chartType + '"}';
        else
            return '{"concreteClass": "models.DistributionCalcSpec", "fieldName": "' + fieldNames[0] + '"}';
    }
}

@itemToRowJsFun = {
    function(item) {
        return "<tr><td><input type='checkbox'></input></td><td id='fieldNames'>" + item + `</td><td>@editableChartType(None)</td></tr>`;
    }
}

@addModalInner = {
    <input type="text" id="newItems" class="typeahead">
}

@dynamicTable("statsCalcSpec", table, true, rowToModelJsFun, itemToRowJsFun, Some(addModalInner))