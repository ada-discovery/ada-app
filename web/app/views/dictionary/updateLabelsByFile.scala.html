@import org.ada.web.controllers.dataset.DataSetWebContext._
@import org.ada.web.controllers.dataset.DataSetWebContext
@()(implicit context: DataSetWebContext)

<div class="row row-margin-bottom">
    <span class="list-group-item list-group-item-action flex-column align-items-start">
        <div class="d-flex w-100 justify-content-between">
            <h4 class="mb-1"><b>Update labels by csv file</b></h4>
        </div>
        <div class="d-flex w-100 justify-content-between">
            <h4 class="mb-1">Rules:</h4>
        </div>
        <ul class="list-group">
            <li class="list-group-item">Accepted only csv extension.</li>
            <li class="list-group-item">Semicolon separator.</li>
            <li class="list-group-item">Text qualifier not considered.</li>
            <li class="list-group-item">Row must be composed by two columns: <i>Name</i> and <i>Label</i> of the variable. Respectively first and second column of csv.</li>
        </ul>
        <div class="form-group">
            <input type="file" class="form-control-file" id="labelsFile" name="labelsFile" />
        </div>
        <div style="margin-top: 10px">
            <button type="button" id="updateLabelsByFileBtn" class="btn btn-primary" onclick="updateLabelsByFile()">Update labels</button>
        </div>

    </span>
</div>


<script type="text/javascript">

    function btnLoading(elem) {
        $(elem).attr("data-original-text", $(elem).html());
        $(elem).prop("disabled", true);
        $(elem).html('<i class="spinner-border spinner-border-sm"></i> Please wait ...');
    }

    function btnReset(elem) {
        $(elem).prop("disabled", false);
        $(elem).html($(elem).attr("data-original-text"));
    }

    function updateLabelsByFile(){
        var formData = new FormData();
        var file = $("#labelsFile")[0].files[0];
        var fileName = file.name
        formData.append(fileName, file)

        var extension = fileName.substr(fileName.lastIndexOf("."));
        var allowedExtensionsRegx = /(\.csv)$/i;
        var isAllowed = allowedExtensionsRegx.test(extension);
        if(isAllowed){
            dictionaryJsRoutes.org.ada.web.controllers.dataset.DictionaryDispatcher.updatesLabelsByFile(fileName).ajax({
                data: formData,
                contentType: false,
                processData: false,
                beforeSend: function (data){
                    btnLoading("#updateLabelsByFileBtn")
                },
                success: function (res){
                    btnReset("#updateLabelsByFileBtn")
                    showMessage(res)
                    window.location.href = '@Html(dictionaryRouter.plainList.url)'
                },
                error: function (err){
                    btnReset("#updateLabelsByFileBtn")
                    showErrorResponse(err)
                }
            })
        } else
            showError("Only file with .csv extension is allowed")
    }

</script>
