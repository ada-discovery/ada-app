@import org.ada.server.models.{DataSetSetting, FilterShowFieldStyle, Link, Menu, StorageType}
@import org.ada.web.controllers.dataset.DataSetWebContext.widgetEngineNames
@import org.incal.core.util.toHumanReadableCamel
@import org.incal.play.controllers.WebContext
@import org.incal.play.controllers.WebContext._
@import views.html.elements._
@import views.html.table.dynamicThreeColumnTable
@import org.ada.server.models.DataSetType

@(form: Form[DataSetSetting])(implicit webContext: WebContext)

@if(form.hasErrors) {
    <div class="form-group">
        <div class="alert alert-danger col-sm-12 text-center">
        @for(error <- form.errors){
            @for(messageErr <- error.messages){
                @messageErr <br/>
            }
        }
        </div>
    </div>
}


@inputTextReadonly("dataSetSetting", "dataSetId", form)

@inputText("dataSetSetting", "dataSetIdGlobalReference", form,
    Seq('_helpModal -> "<p>Global id reference of <i>Data Set Id</i> contained in <i>Data Catalog</i>.</p>"))

@select("dataSetSetting", "storageType", form,
    StorageType.values.toSeq.sortBy(_.id).map(value => (value.toString, value.toString)), false
)


@labelValue("dataSetInfo.dataSetTypeName", attributeLabel("dataSetSetting", "Data Set Type"), labelGridWidth = 2,
    helpModalContent = Option(Html("<p>Mandatory only if Omics data set type</p>"))) {
    @selectEnum("dataSetInfo.dataSetType", DataSetType, true, Some("form-control"), form.value.flatMap(_.dataSetInfo.map(_.dataSetType.toString)))

}

@labelValue("dataSetInfo.dataSetJoinIdName", attributeLabel("dataSetSetting", "Data Set Join Field"), labelGridWidth = 2,
            helpModalContent = Option(Html("<p>Field used to make join with other Omics data sets</p>"))) {
    @typeahead("dataSetInfo.dataSetJoinIdTypeahead", "dataSetInfo.dataSetJoinIdName",
        typeaheadValue = form("dataSetInfo.dataSetJoinIdName").value,
        value = form("dataSetInfo.dataSetJoinIdName").value,
        extraClass = Some("form-control"))
}

@checkbox("dataSetSetting", "mongoAutoCreateIndexForProjection", form)

<hr/>

@inputFieldTypeahead("dataSetSetting", "keyField", form)
@inputFieldTypeahead("dataSetSetting", "exportOrderByField", form)
@inputFieldTypeahead("dataSetSetting", "defaultDistributionField", form)
@inputFieldTypeahead("dataSetSetting", "defaultScatterXField", form)
@inputFieldTypeahead("dataSetSetting", "defaultScatterYField", form)
@inputFieldTypeahead("dataSetSetting", "defaultCumulativeCountField", form)
@inputText("dataSetSetting", "displayItemName", form)

@select("dataSetSetting", "filterShowFieldStyle", form,
    FilterShowFieldStyle.values.toSeq.sortBy(_.id).map(value => (value.toString, toHumanReadableCamel(value.toString))), true
)

@checkbox("dataSetSetting", "filterShowNonNullCount", form)
@checkbox("dataSetSetting", "showSideCategoricalTree", form)

@inputTypeahead(
    "dataSetSetting",
    "ownerId",
    "ownerTypeahead",
    form,
    "User"
)

@textarea("dataSetSetting", "description", form, Seq('cols -> 20, 'rows -> 5))

@rowToModel = {
    <script type="text/javascript">
          function rowToModel(row) {
                function value(x) { return getRowValue(row, x) }

                var header = value("field1")
                if (!header)
                    header = ""
                const label = value("field2")
                const url = value("field3")

                return {"concreteClass": "org.ada.server.models.Menu", "header": header, "links": [{"label": label, "url": url}]}
          }
    </script>
}

@dynamicThreeColumnTable(
    "extraNavigationItem",
    "Extra Navigation Items",
    "Menu Header",
    "Link Label",
    "Link URL",
    form.value.map(_.extraNavigationItems.flatMap { navigationItem =>
        navigationItem match {
            case Link(label, url) => Seq(("", label, url))
            case Menu(header, links) => links.map( link => (header, link.label, link.url))
        }
    }).getOrElse(Nil),
    Some(rowToModel)
)

@inputText("dataSetSetting", "customControllerClassName", form)

@select("dataSetSetting", "widgetEngineClassName", form, widgetEngineNames(toConfiguration), true)